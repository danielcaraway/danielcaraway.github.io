---
layout: single
title: "dailylog 7-28-20"
tags: dailylog
---

```python
df = og_df_new.copy()

def make_pivot_table_for_graphs(df, _x, _y):
    df[_y] = df[_y].astype('category')
#     tempcol = df.columns[-2]
    df1 = df.groupby([_x,_y])[_y].count().rename('count').reset_index()
    df2 = dict(df1.groupby(_x)['count'].sum())
    df1['total'] = df1.apply(lambda x: df2[x[_x]], axis=1)
    df1['percent'] = df1['count']/df1['total']
    print(df1)

make_pivot_table_for_graphs(df, 'executive_leader', 'ipf_binned')
```

```python
df = og_df_new.copy()
df = df[df['executive_leader'] != 'Office of the CEO']
rdylgn = '"#cccccc" "#D7191C" "#FDAE61" "#A6D96A" "#1A9641"'.replace('"','').split(' ')

# --- CREATING A "PIVOT TABLE" WITH GROUPBY
# dftemp is to get and pass the COUNT

def make_pivot_table_for_graphs(df, _x, _y):
#     df[_y] = df[_y].astype('category')
#     dftemp = df.groupby(_x)[_y].value_counts()
#     dftemp = dftemp.rename('count').reset_index()
#     df1 = df.groupby(_x)[_y].value_counts(normalize=True)
#     df1 = df1.mul(100)
#     df1 = df1.rename('percent').reset_index()
#     df1['count'] = dftemp['count']
    df[_y] = df[_y].astype('category')
#     tempcol = df.columns[-2]
    df1 = df.groupby([_x,_y])[_y].count().rename('count').reset_index()
    df2 = dict(df1.groupby(_x)['count'].sum())
    df1['total'] = df1.apply(lambda x: df2[x[_x]], axis=1)
    df1['percent'] = (df1['count']/df1['total'])*100
    df1 = df1[[_x, _y, 'count', 'percent']]
#     print(df1.columns)
#     df1.drop('total', inplace=True, axis=1)
    return df1


def make_barchart_by_percent_with_count(df, COLUMNS, COLUMN, X_AXIS, Y_AXIS, X_AXIS_LENGTH, axes, i):
#     print(len(df), COLUMNS, COLUMN, X_AXIS, Y_AXIS, X_AXIS_LENGTH, axes, i)
    sm_df = df[df[COLUMNS] == COLUMN]
#     print(sm_df)
#     print(sm_df['ipf_binned'])
#     print(len(df))
    bar = axes[i].bar(sm_df[X_AXIS], sm_df[Y_AXIS])
    for j, p in enumerate(axes[i].patches):

        num = sm_df['count'].values[j]
#         print(num)
        __x = p.get_x() + (p.get_width()/2.2)
        __y = p.get_y() + p.get_height() +1
        axes[i].annotate(num, (__x,__y))
    axes[i].tick_params(axis="x", labelsize=10)

    #  --- COLORING THE COLUMNS
    # using k because i & j are being used
    for k in range(X_AXIS_LENGTH):
        try:
            bar[k].set_color(colors[k])
        except:
            pass

    # keep only the leftmost graph's spine
    if i != 0:
        axes[i].spines['left'].set_visible(False)
        axes[i].get_yaxis().set_visible(False)
    axes[i].spines['right'].set_visible(False)

    axes[i].spines['top'].set_visible(False)
    if len(df) > 220:
        axes[i].set_xlabel(COLUMN, fontproperties=multiplot_x, rotation=45, ha='right')
    else:
        axes[i].set_xlabel(COLUMN, fontproperties=multiplot_x)
#     axes[i].set_title(COLUMN)



# ==================================================================================
# --- INPUT STUFF HERE
# ==================================================================================



# ==================================================================================
# ==================================================================================
# --- RUN THE THING!!
# ==================================================================================


def make_multi_bar_graph(df,_x,_y):
    # what we want grouped

    df1 = make_pivot_table_for_graphs(df,_x,_y)

    # what we want each x and y to look like
    X_AXIS, Y_AXIS = _y, 'percent'

    # colors, duh
    colors = list(reversed(rdylgn))

    df1 = df1.sort_values(by=X_AXIS, ascending=False)
    cols = df1[_x].value_counts().shape[0]
    fig, axes = plt.subplots(1, cols, figsize=(20, 8), sharex=True, sharey=True)


    for i, one_of_x in enumerate(set(df1[_x])):
        # passing X_AXIS_LENGTH for coloring the columns
        X_AXIS_LENGTH = len(set(df1[X_AXIS].values))

        make_barchart_by_percent_with_count(df1, _x, one_of_x, X_AXIS, Y_AXIS, X_AXIS_LENGTH, axes, i )
    plt.show()


# _x,_y = 'executive_leader', 'ipf_binned'
df = og_df_new.copy()
df = df[df['executive_leader'] != 'Office of the CEO']
# make_multi_bar_graph(df, 'executive_leader', 'ipf_binned')
len(df)


df = og_df_new.copy()
df = df[df['executive_leader'] != 'Office of the CEO']
make_multi_bar_graph(df, 'executive_leader', 'ipf_binned')
```

## Copy Pasta

```python

df = og_df_new.copy()

def make_stacked_bar_chart():
    ax = sm_df_g.plot.barh(stacked=True)

rdylgn = '"#cccccc" "#D7191C" "#FDAE61" "#A6D96A" "#1A9641"'.replace('"','').split(' ')
rdylgn = list(reversed(rdylgn))
customPalette = sns.set_palette(sns.color_palette(rdylgn))
sm_df = df[df['dept_binned'] == 'Commercial' ]
sm_df_g = sm_df.groupby(
    ['department', 'ipf_binned']).size().reset_index().pivot(
    columns='ipf_binned', index="department", values=0)
sm_df_g.fillna(0, inplace=True)
# sm_df_g.sort_values(by='ipf_binned', ascending=False, inplace=True)
sm_df_g.loc[:,'Total'] = sm_df_g.sum(axis=1)
sm_df_g.sort_values(by='Total', ascending=False, inplace=True)


sm_df_g = sm_df_g[[4,3,2]]


# col_dict = {}
col_dict = dict(zip(range(0,len(sm_df_g.values)),[0]*len(sm_df_g.values)))

ax = sm_df_g.plot.barh(stacked=True)

for col in sm_df_g.columns:
    for i, v in enumerate(sm_df_g[col]):
        col_dict[i] = col_dict[i] + v
        new_v = col_dict[i]
        v_text = str(round(v))
        if(v!=0):
            ax.text(new_v-len(v_text), i," "+v_text, color='white', va='center', fontweight='bold', fontsize='8')
plt.figure(figsize=(10,6), dpi=300)
plt.show()

```
